<!DOCTYPE html><html>  <head>    <title>Heating control</title>	<style>	body {		background-color: #c4e3ed;	}	.button {	  display: inline-block;	  width: 55px;      height: 33px;		  	  padding: 3px 5px;	  font-size: 18px;	  margin: 4px 2px;	  cursor: pointer;	  text-align: center;	  text-decoration: none;	  	  outline: none; 	  color: white;	  background-color: #9090BB;	  border: 3px solid #535353;	  border-radius: 9px;	  box-shadow: 0 6px #999;	  -webkit-transition-duration: 0.4s; /* Safari */	  transition-duration: 0.4s;	}	.button:hover {	  border: 3px solid #535353;	  border-radius: 9px;	  opacity: 0.7;	  color: white;	}	.button:active{		background-color: #CC3030;		box-shadow: 0 3px #666;		transform: translateY(4px);	}	.barOn{		background-color: #EE1010;	}	.barOff{		background-color: #3030EE;	}	.sync{			background-color: #40DD40;			width: 255px;	}		</style>  </head>  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <body>  <div ><h2 align="center">Cottage 60/1</h2></div>  <p align="center" >	<?php  				$EQW = 0; /* $bar1 - 8, $bar2 - 7, $bar3 - 6, $barW - 5, $hfPump - 4, $hrPump - 3, $hwPump - 2, $boilerPump - 1, $caminPump - 0 */		include 'heatData.php'; 		/* 'heatData.php' has been created by 'a6script.php' and contains the following variables:		$mTH, $mTM, $mTS - hours, minutes and seconds wenn the data are taken		$Ut, $Um, $Bm, $Bt - temperature values of the heat akumulator at the 		top, upper middle, bottom (lower) middle and bottom sensors. 		$kitT, $livT, $bathT, $corrT, $bedT - real temperature in the kitchen, living room, bath, corridor, bed room.				*/			include 'settings.php';		/* 'settings.php' contains heating equipment settings: 		1. bar1, bar2, bar3 ON or OFF (under the condition, that just two of them can be in the ON status)		2. barW (for the summer scenario, under condition that all of the other bars are switched off)		3. threshold T° for the bars to be switched on (15° at the bottom of the heat akkymulator tank)			$bar1 = false; $bar2 = false; $bar3 = false; $barW = false; $BtT = 15;		4. pumps on/off state: $hfPump1 = false; $hrPump2 = false; $hwPump = false; $boilerPump = false; $caminPump = false;		5. threshold T° in roooms: Kitchen (Tkit = 20°), Living (Tliv = 22°), Bath room (Tbr = 23°), Bed room (BedT = 18°)			$TkitT = 20; $TlivT = 21; $TbathT = 23; $TbedT = 18;		6. scenarios: Workday, Holliday, Party, Vacation, OFF.			$Scen = "Vacation";		7. heating: Wood, Gas, E-Night, E-Night05, E-EntireDay			$heating = "Wood";		*/		$EQW =  $bar1 * 256 + $bar2 * 128 + $bar3 * 64 + $barW * 32 + $hfPump * 16 + $hrPump * 8 + $hwPump * 4 + $boilerPump * 2 + $caminPump * 1;				if ($EQW < 10) $EQW = "00" . $EQW;  /* $EQW converted from int to Staring */		elseif ($EQW < 100) $EQW = "0" . $EQW;				/*		$EQW = 0b000000000; echo $EQW . " " . decbin($EQW) . "<br>";		if( $caminPump )  $EQW += 1; echo $EQW . " " . decbin($EQW) . "<br>";			if( $boilerPump ) $EQW += 2; echo $EQW . " " . decbin($EQW) . "<br>";				if( $hwPump ) $EQW += 4; echo $EQW . " " . decbin($EQW) . "<br>";				if( $hrPump ) $EQW += 8; echo $EQW . " " . decbin($EQW) . "<br>";		if( $hfPump ) $EQW += 16; echo $EQW . " " . decbin($EQW) . "<br>";		if( $barW ) $EQW += 32; echo $EQW . " " . decbin($EQW) . "<br>";		if( $bar3 ) $EQW += 64; echo $EQW . " " . decbin($EQW) . "<br>";		if( $bar2 ) $EQW += 128; echo $EQW . " " . decbin($EQW) . "<br>";		if( $bar1 ) $EQW += 256; echo $EQW . " " . decbin($EQW) . "<br>";			echo "bar1 " . $bar1 . "<br>";		echo "bar2 " . $bar2 . "<br>";		echo "bar3 " . $bar3 . "<br>";		echo "barW " . $barW . "<br>";		echo "hfPump " . $hfPump . "<br>";		echo "hrPump " . $hrPump . "<br>";		echo "hwPump " . $hwPump . "<br>";		echo "boilerPump " . $boilerPump . "<br>";		echo "caminPump " . $caminPump . "<br>";						echo $bar1 . $bar2 . $bar3 . $barW . $hfPump . $hrPump . $hwPump . $boilerPump . $caminPump . "<br>";		echo $EQW . "<br>";		echo decbin($EQW) . "<br>";*/		printf("Equipment state = %b <br>", $EQW);	?> 	<font face = "arial" size = "3">	<?php  		echo "Now: ";		date_default_timezone_set("Europe/Moscow");		echo date("H:i:s") . "  " . date("d.m.Y") . "<br>";		echo "A6:  " . $mTH . ":" . $mTM . ":" . $mTS . "  " . $mDD . "." . $mDM . "." . $mDY . "<br><br>";		/*echo "TstT: " . $TstT . "<br><br>";*/	?>		<canvas id="heatAkk" width="150" height="330" style="border:3px solid #535353; border-radius: 12px; box-shadow: 0 4px #999;">		Your browser does not support the HTML5 canvas tag.</canvas>	<canvas id="woodBoiler" width="80" height="120" style="border:3px solid #535353; border-radius: 9px; box-shadow: 0 4px #999;">		Your browser does not support the HTML5 canvas tag.</canvas>	<script>		function buttonRequest(EqID, EqSwitch) { /*** changes the color of switched on and off buttons ****/		var b = document.getElementById(EqID);			if(EqSwitch == true) { b.classList.remove("barOff"); /***** b.classList.toggle("active"); ******/				b.classList.add("barOn"); }			else { b.classList.remove("barOn");				b.classList.add("barOff"); }		}				function barSwitch(EqSwitch) { /*** switches on/off heating bars ***/			var p = 0;			if (EqSwitch == true) return false; /* switch off without checking */			 else {						/* if a heating bar should be switched on we have to check available el. power */				if (Bar1 == true) p++;					if (Bar2 == true) p++;				if (Bar3 == true) p++;				if (BarhW == true) p++; 				if ( p > 1 ) { window.alert(" Power restriction!\n Do NOT switch on! "); return false; }				else if ( p < 2 ) return true; /* just two bars can be switched of at the time */				}			}					var Bar1 = true;		var Bar2 = false;		var Bar3 = true;		var BarhW = false;				function tempRGB( T ) {  /* calculates colors for 7 points gradient */			var R = 0, G = 0, B = 0; 			var rgb = "#";			if ( T > 70) { R = 255;		G = 255; 	B = Math.floor( 255 * (T-70) / 30 );}					 		else if ( T <= 70 && T > 60 ) { R = 255;	G = Math.floor( 127 * ( T - 60 ) / 10 + 128 ); 	B = 0; }			else if ( T <= 60 && T > 50 ) { R = 255;	G = Math.floor( 127 * (T-50) / 10 ); 	B = 0;}			else if ( T <= 50 && T > 30 ) { R = Math.floor( 255 * (T-30) / 20 );	G = Math.floor( 255 *(50 - T) / 20 ); B = 0;}			else if ( T <= 30 && T > 10 ) { R = 0;	 G = Math.floor(255 * (T-10) / 20 ); B = Math.floor( 255 * (30 - T) / 20 );}			else if ( T <= 10 && T > 0 ) {	R = 0;	G = 0; B = Math.floor( 255 * T / 10 ); }			else { R = 50;	G = 50; B = 55;}			if ( R < 16 ) rgb += "0"; rgb += R.toString(16).toUpperCase();			if ( G < 16 ) rgb += "0"; rgb += G.toString(16).toUpperCase();			if ( B < 16 ) rgb += "0"; rgb += B.toString(16).toUpperCase(); 			return 	rgb; 		}								var Ut = <?php echo $Ut ?>;		var Um = <?php echo $Um ?>;		var Bm = <?php echo $Bm ?>;		var Bt = <?php echo $Bt ?>;		var stEn = <?php echo $stEn ?>; /* stored Energy */		var boilerPump = <?php echo $boilerPump ?>;		/* boilerPump = false; */								var c = document.getElementById("heatAkk");		var ctx = c.getContext("2d");		var grd = ctx.createLinearGradient(0,5,0,325); 		grd.addColorStop(0, tempRGB( Ut )); 		grd.addColorStop(0.16, tempRGB( ( Ut + Um )/ 2 )); 		grd.addColorStop(0.33, tempRGB( Um ));		grd.addColorStop(0.5, tempRGB( ( Um + Bm )/ 2 ));		grd.addColorStop(0.66, tempRGB( Bm ));			grd.addColorStop(0.83, tempRGB( ( Bm + Bt )/ 2 ));		grd.addColorStop(1, tempRGB( Bt ));				ctx.fillStyle = grd; 		ctx.fillRect(5,5,140,320);							ctx.font = "18px Arial";		ctx.fillStyle = "white";		ctx.fillText( Bt + "°" , 15, 315);		ctx.fillText( Bm + "°" , 15, 215);		if (Um > 60) ctx.fillStyle = "grey";		ctx.fillText( Um + "°" , 15, 115);		if (Ut > 60) ctx.fillStyle = "grey"; 		ctx.fillText( Ut + "°" , 15, 25);		ctx.font = "22px Arial";		if ( (Ut+Um)/2 > 60) ctx.fillStyle = "grey"; else ctx.fillStyle = "white";			ctx.fillText( stEn + " kWh", 50, 65);				var canv = document.getElementById("woodBoiler");		var contx = canv.getContext("2d");		var grd = contx.createLinearGradient(0,5,0,115); 							grd.addColorStop(0, tempRGB( Ut )); 		grd.addColorStop(1, tempRGB( Ut-15 )); 				/* <?php if ($boilerPump == true) echo "contx.drawImage(imgF, 20, 70);" ?> 		window.onload = function() { };  */						var imgF = new Image();  			imgF.src ='fire.png'; 			var imgW = new Image();  			imgW.src ='woodB.png'; 						contx.fillStyle = grd; 				contx.fillRect(5,5,70,110);					if (boilerPump)	imgF.onload = function() {						contx.drawImage(imgF, 20, 70); };									else imgW.onload = function() {						contx.drawImage(imgW, 20, 70);	};										/*if (boilerPump) contx.drawImage(imgF, 20, 70);			else contx.drawImage(imgW, 20, 70); */						contx.font = "16px Arial";			contx.fillStyle = "white";			if (Ut > 60) contx.fillStyle = "grey";			contx.fillText( "Heating" , 8, 25);			</script>	<form action="controlData.php" method="post" align="center">		<input type="button" id = "B1"  name = "Bar_1"  class="button <?php if ($bar1 == true) echo "barOn"; else echo "barOff"; ?>" onclick = " Bar1 = barSwitch(Bar1);   buttonRequest(id, Bar1)"  value="1." >     <input type="button" id = "B2"  name = "Bar_2"  class="button <?php if ($bar2 == true) echo "barOn"; else echo "barOff"; ?>" onclick = " Bar2 = barSwitch(Bar2);   buttonRequest(id, Bar2)"  value="2." >     <input type="button" id = "B3"  name = "Bar_3"  class="button <?php if ($bar3 == true) echo "barOn"; else echo "barOff"; ?>" onclick = " Bar3 = barSwitch(Bar3);   buttonRequest(id, Bar3)"  value="3." > 	<input type="button" id = "BhW" name = "Bar_hW" class="button <?php if ($barW == true) echo "barOn"; else echo "barOff"; ?>" onclick = " BarhW = barSwitch(BarhW); buttonRequest(id, BarhW)" value="hW" > <br>		<b>Pumps:</b><br>    <input type="checkbox" name="hfPump" value="heatFPump" <?php if ($hfPump1 == true) echo "checked";?> >1st floor&nbsp	<input type="checkbox" name="boilPump" value="boilerPump"<?php if ($boilerPump == true) echo "checked";?>>Boiler&nbsp<br>	    <input type="checkbox" name="hrPump"  value="2ndFPump" <?php if ($hrPump2 == true) echo "checked";?>>2nd floor	<input type="checkbox" name="camPump" value="caminPump"  <?php if ($caminPump == true) echo "checked";?>>Camin<br>	<input type="checkbox" name="hwPump" value="hotWPump"  <?php if ($hwPump == true) echo "checked";?>>Hot water &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>	        	<b>Scenario:</b><br>	<input type="radio" name="scenario" <?php if (isset($scenario) && $scenario=="Workday") { echo "checked"; }?> value="Workday">Workday	<input type="radio" name="scenario" <?php if (isset($scenario) && $scenario=="Holiday") { echo "checked"; }?> value="Holiday">Holiday<br>	<input type="radio" name="scenario" <?php if (isset($scenario) && $scenario=="Party") { echo "checked"; }?> value="Party">Party	<input type="radio" name="scenario" <?php if (isset($scenario) && $scenario=="Vacation") { echo "checked"; }?> value="Vacation">Vacation	<input type="radio" name="scenario" <?php if (isset($scenario) && $scenario=="OFF") { echo "checked"; }?> value="OFF">OFF 		<span class="error"> <?php /*$scenarioErr = "<br>No scenario selected! <br>"; echo $scenarioErr;  !!! TO BE INVESTIGATED!!! */?></span>	<br>    	<input type="submit" class="button sync" value="Syncronize">	</form><!-- HTML comments/* necessary data from the app :	1. bar1, bar2, bar3 (0 vs. 1) - buttons	2. hotW (0/1) - button	3. threshold T for the bars switch on (25°)	4. threshold T in roooms: Kitchen (Tkit = 20°), Living (Tlr = 22°), Bath room (Tbr = 23°), Bed room (BedT = 18°)	5. scenarios: Working day, Holliday, Vacation, Party, OFF.		In the trial version the App script build up a file with 1.-5. data.	The A6 script read the data from SetUp.txt file and insert them into heatData.txt as an aknowledgement that the data are received.*/-->	  <?php echo "<br> eqw: " . $eqw . " EQW: " . $EQW . "<br>"; 	  ?>	</font>  </p>  </body></html>