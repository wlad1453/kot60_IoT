<!DOCTYPE html><html>  <head>    <title>A6 data</title>  </head>  <body>  <p>  <?php       $EQW = 0; /* $bar1 - 8, $bar2 - 7, $bar3 - 6, $barW - 5, $hfPump - 4, $hrPump - 3, $hwPump - 2, $boilerPump - 1, $caminPump - 0 */		include 'heatData.php'; 		/* 'heatData.php' has been created by 'a6script.php' and contains the following variables:		$mTH, $mTM, $mTS - hours, minutes and seconds wenn the data are taken		$Ut, $Um, $Bm, $Bt - temperature values of the heat akumulator at the top, upper middle, bottom (lower) middle and bottom sensors. 		$kitT, $livT, $bathT, $corrT, $bedT - real temperature in the kitchen, living room, bath, corridor, bed room.			$boilerPump = false; $caminPump = false; - status of the boiler and camin pumps.		*/			include 'settings.php';		/* 'settings.php' contains heating equipment settings: 		1. bar1, bar2, bar3 ON or OFF (under the condition, that just two of them can be switched ON at the sane time)		2. barW (for the summer scenario, under condition that all of the other bars are switched off)		3. threshold T° for the bars to be switched on (15° at the bottom of the heat akkymulator tank or 20° as a middle value(?))			$bar1 = false; $bar2 = false; $bar3 = false; $barW = false; $BtT = 15;		4. pumps on/off state: $hfPump1 = false; $hrPump2 = false; $hwPump = false; 		5. threshold T° in roooms: Kitchen (Tkit = 20°), Living (Tliv = 22°), Bath room (Tbr = 23°), Bed room (BedT = 18°)			$TkitT = 20; $TlivT = 21; $TbathT = 23; $TbedT = 18;		6. scenarios: Workday, Holliday, Party, Vacation, OFF.			$Scen = "Vacation";		7. heating: Wood, Gas, E-Night, E-Night05, E-EntireDay			$heating = "Wood";		*/		$EQW =  $bar1 * 256 + $bar2 * 128 + $bar3 * 64 + $barW * 32 + $hfPump * 16 + $hrPump * 8 + $hwPump * 4 + $boilerPump * 2 + $caminPump * 1;		/* Equipment status as set up values */		if ($EQW < 10) $EQW = "00" . $EQW;		elseif ($EQW < 100) $EQW = "0" . $EQW;				/*echo "filter_has_var: <br>";		echo !filter_has_var(INPUT_GET, "Ut") . "<br>"; */					if (!filter_has_var(INPUT_GET, "Ut")) 	$Ut = 90; 		else  $Ut = $_GET['Ut'];	if (!filter_has_var(INPUT_GET, "Um")) 	$Um = 70; 		else  $Um = $_GET['Um'];	if (!filter_has_var(INPUT_GET, "Bm")) 	$Bm = 50; 		else  $Bm = $_GET['Bm'];	if (!filter_has_var(INPUT_GET, "Bt")) 	$Bt = 30; 		else  $Bt = $_GET['Bt'];	if (!filter_has_var(INPUT_GET, "TstT")) $TstT = 36.6; 	else  $TstT = $_GET['TstT'];	if (!filter_has_var(INPUT_GET, "eqw")) 	$eqw = 0; 		else  $eqw = $_GET['eqw'];	    /*&Ut = 100; } 	else { $Ut = $_GET['Ut']; }		$Ut = $_GET['Ut']; if ($Ut > 0); else $Ut = 100;    $Um = $_GET['Um'];    $Bm = $_GET['Bm'];	$Bt = $_GET['Bt']; 		$TstT = $_GET['TstT'];		$eqw = $_GET['eqw'];*/ /* Equipment status as sensor data aka measured values */		/* default values: 	$Ut = 49;     $Um = 46;    $Bm = 44;	$Bt = 40; 		$TstT = 36.6;		$eqw = 151;*/			if( $eqw % 2) {		$caminPump = 1;		$eqw--;		}	else $caminPump = 0;	$eqw /= 2;				$eqw = $EQW;		$bar1 = 1; /* PLC behaviour simulation */	$bar2 = 0; 	$bar3 = 1; 	$barW = 0; 		$hfPump1 = 1; $hrPump2 = 1; $hwPump = 0; /* set up of pumps ON/OFF */		$boilerPump = 1; $caminPump = 0; 		/*** pumps ON/OFF status simulation ***/		$BtT = 15; $TkitT = 20; $TlivT = 21; $TbathT = 23; $TbedT = 18; 			/*** Threshold values ***/		$kitT = 18 + mt_rand(0, 8); $livT = 17 + mt_rand(0, 8); $bathT = 20 + mt_rand(0, 7); $corrT = 17 + mt_rand(0, 8); $bedT = 16 + mt_rand(0,8);											/*** simulation of the current temperature in rooms, !!! further task - to simulate them within A6 !!! ***/		$Scen = "Vacation";															/* Scenarios: Workday, Holliday, Party, Vacation, OFF. */			$heating = "Wood"; 															/* Heating with: Wood, Gas, E-Night, E-Night05, E-EntireDay */		$middleT = ( $Ut + $Um + $Bm + $Bt ) / 4; 									/* middle temperature in the water tank */	$heatBufferVolume = 980;													/* Liters, kG */	$cWater = 4.184; 															/* water thermal capacity by 60°C kJ/(kG*K) */	$refT = 20;																	/* Reference temperature */	$storedEnergy = $heatBufferVolume * $cWater * ($middleT - $refT) / 3600; 	/* stored heat energy in kWh */		$H_data = array ("Ut"=>$Ut, "Um"=>$Um, "Bm"=>$Bm, "Bt"=>$Bt, "kitT"=>$kitT, "livT"=>$livT, "bathT"=>$bathT, "corrT"=>$corrT, "bedT"=>$bedT, "TstT"=>$TstT);	/*	$Ut = 151; $Um = 70; $Bm = 50; $Bt = 30; $kitT = 26; $livT = 21; $bathT = 27; $corrT = 19; $bedT = 17; $TstT = 36.6;		DB: R_KitT	decimal(5,2), R_LivT decimal(5,2), R_BedT decimal(5,2), R_KorT decimal(5,2), R_BathT double(5,2), R_HrT*/		 		 		/*	echo "Energy: " . $storedEnergy;	printf("Energy2: %.2f ", $storedEnergy);*/   		date_default_timezone_set("Europe/Moscow");  		$measT = date("H:i:s");			/* measurement time H, i, s */	$measD = date("d/m/y");	$mTH = strval( date("H") ); 	$mTM = strval( date("i") );	$mTS = strval( date("s") );		$mDD = strval( date("j") ); 	$mDM = strval( date("m") ); 	$mDY = strval( date("Y") ); 		/* mail("vfabian@mail.ru","Data from A6",$measT); */	    /* $HeatData = date("H:i:s"). "<br>Upper...... " . $Ut . "&#8451, <br>UMiddle. " . $Um . "&#8451, <br>BMiddle. " . $Bm . "&#8451, <br>Bottom... ". $Bt . "&#8451<br>"; */	$HeatData  = "\n\$mTH = \"" . $mTH . "\";\n \$mTM = \"" . $mTM . "\";\n \$mTS = \"" . $mTS . "\";\n";	 $HeatData  = "\n\$measT = \"" . $measT . "\";\n \$measD = \"" . $measD . "\";\n"; 	 $HeatData .= " \$eqw = " . $eqw . ";\n";	 $HeatData .= "\$Scenario = \"". $Scen . "\";\n \$heating = \"". $heating . "\";\n";	echo $HeatData . "<br>";	/* echo "000";  */	 $HeatData .= "\$mDD = \"" . $mDD . "\";\n \$mDM = \"" . $mDM . "\";\n \$mDY = \"" . $mDY . "\";\n"; 	 	 $HeatData .= " \$Ut = " . $Ut . ";\n \$Um = ". $Um . ";\n \$Bm = ". $Bm . ";\n \$Bt = ". $Bt . ";\n";	 $HeatData .= " \$kitT = " . $kitT . ";\n \$livT = ". $livT . ";\n \$bathT = ". $bathT . ";\n \$corrT = ". $corrT . ";\n \$bedT = ". $bedT . ";\n \$TstT = ". $TstT . ";\n";	 $HeatData .= " \$stEn = " . round($storedEnergy, 1) . ";\n";	 $HeatData .= " \$bar1 = " . $bar1 . ";\n \$bar2 = " . $bar2 . ";\n \$bar3 = " . $bar3 . ";\n \$barW = ". $barW . ";\n ";	 $HeatData .= "\$hfPump = ". $hfPump1 . ";\n \$hrPump = ". $hrPump2 . ";\n \$hwPump = ". $hwPump . ";\n \$boilerPump = ". $boilerPump. ";\n \$caminPump = ". $caminPump . ";\n";	 	 /* echo "\nTime: " . $measT . "<br>\n"; */	 	 if ( $mTH % 6 == 0 ) {		mail("vfabian@mail.ru","Data from A6",$HeatData);	 }       $heatDataFile = fopen("heatData.txt", "w") or die("Unable to open file!");            fwrite($heatDataFile, $HeatData);	  fclose($heatDataFile); 	  	  $HeatData = "<?php\n " . $HeatData . "?>\n"; 	  	  $heatDataFile = fopen("heatData.php", "w") or die("Unable to open file!");            fwrite($heatDataFile, $HeatData);	  fclose($heatDataFile); 	  	  echo "DBfunc<br>";	  require'kot60db/DB_functions.php';	  db_entry($conn, $H_data);	      ?>  </p>  </body></html>